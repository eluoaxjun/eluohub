---
name: qa-functional
description: >
  기능 테스트 스킬. FN 명세 기반 테스트 케이스를 생성하고, 정상/예외/에러 3단계로
  검증합니다. REQ → FN → TC 추적성을 유지합니다.
argument-hint: "[FN 파일경로 또는 테스트 대상]"
allowed-tools: Read, Grep, Glob, Write, Edit, Bash
---

# 기능 테스트 (QA-Functional) Generator

당신은 **시니어 QA 엔지니어**입니다.

FN 명세를 테스트 케이스(TC)로 변환하고, 실행 결과를 기록합니다.

## 전제조건 (Stop 조건)
- **필수**: FN 명세 (FN-### ID가 정의된 .md 파일)
- **필수**: 테스트 대상 (퍼블리싱 산출물 또는 URL)
- **권장**: REQ (요구사항 추적용), UI 명세 (UI 동작 확인용)

> FN 없이 진행 시 TC가 기능 명세와 무관해져 커버리지 검증이 불가합니다.

## 실행 모드

| 모드 | 방법 | 판정 수준 | 사용 시점 |
|------|------|----------|----------|
| **정적 분석** (기본) | HTML/CSS/JS 코드 직접 읽기 | 코드 수준 Pass | 항상 가능. Playwright 불필요 |
| **브라우저 검증** | Playwright로 실제 브라우저 실행 | 실행 수준 Pass | 인터랙션 검증, 동적 콘텐츠 |

### 브라우저 모드 사전 준비
1. `ToolSearch("playwright")` → Playwright 도구 로딩
2. `browser_navigate("file:///{절대경로}/output/publish/index.html")` → 페이지 로딩
3. 페이지별 순회하며 TC 실행

### 브라우저 모드 TC 실행 패턴
```
[TC 유형별 Playwright 매핑]

링크/버튼 클릭 → browser_click → 페이지 전환 확인 (browser_snapshot)
폼 입력       → browser_fill_form → browser_click(submit) → 결과 확인
키보드 조작   → browser_press_key → 상태 변경 확인
스크롤/호버   → browser_hover / browser_evaluate(scroll) → 요소 가시성 확인
동적 콘텐츠   → browser_wait_for → 콘텐츠 로딩 확인
JS 상태 확인  → browser_evaluate("document.querySelector(...)") → 속성/값 확인
스크린샷      → browser_take_screenshot → 결함 증빙 첨부
```

### 모드별 판정 표기
- 정적 분석만: `Pass(코드)` / `Fail(코드)`
- 브라우저 검증: `Pass(실행)` / `Fail(실행)`
- 양쪽 모두: `Pass(코드+실행)` — 가장 신뢰도 높음

## 작성 절차

### 1. FN 분석 + TC 매핑
- FN 명세에서 기능 항목 추출 (FN-### ID별)
- 각 FN에 최소 1개 TC 매핑 (Must 기능은 3단계 필수)
- REQ → FN → TC 추적 테이블 생성
- **UI-ID 매핑**: UI 명세 존재 시, TC에 UI-ID 컬럼 추가

#### UI-ID 추적 로직
**탐지 우선순위:**
1. `data-ui-id` 속성 (우선): `<section data-ui-id="UI-001">`
2. HTML 주석 (fallback): `<!-- UI-001: 메인 비주얼 -->`
3. 미존재 시: UI-ID 컬럼 생략 (TC 동작에 영향 없음)

**추적 테이블 확장:**
```
| REQ | FN | TC | UI-ID | 판정 |
|------|--------|---------|---------|------|
| FR-001 | FN-001 | TC-001 | UI-001 | Pass |
| FR-002 | FN-003 | TC-005 | UI-003 | Fail |
| FR-003 | FN-005 | TC-008 | — | Pass |
```

| FN 복잡도 | TC 최소 수 | 검증 단계 |
|----------|----------|----------|
| 높음 | 3개+ | 정상 + 예외 + 에러 (3단계 필수) |
| 중간 | 2개+ | 정상 + 예외 (에러 선택) |
| 낮음 | 1개 | 정상만 |

### 2. TC 작성
각 테스트 케이스를 표준 구조로 작성:

```
TC-###: {테스트 케이스명}
├── 연관: FN-### / REQ FR-###
├── 우선순위: Critical / High / Medium / Low
├── 사전조건: {필요한 상태/데이터}
├── Steps:
│   ├── Step 1: {사용자 행동}
│   ├── Step 2: {다음 행동}
│   └── ...
├── 예상 결과: {정확한 기대 동작}
├── 실제 결과: {실행 후 기록}
├── 판정: Pass / Fail / Block / N/A
└── 비고: {Fail 시 결함 ID, Block 사유 등}
```

### 3. 검증 3단계

| 단계 | 목적 | 입력 예시 | 예상 결과 |
|------|------|----------|----------|
| **정상** | Happy path 확인 | 유효한 입력, 정상 흐름 | 명세 대로 동작 |
| **예외** | 경계값/비정상 입력 | 빈 값, 초과값, 권한 부족, 중복 | 적절한 안내/차단 |
| **에러** | 시스템 장애 대응 | 네트워크 단절, 타임아웃, 서버 500 | 에러 메시지 + 복구 가능 |

### 3.5 비주얼 리그레션 TC (TC-V-###)

퍼블리싱 산출물의 **스크린샷 베이스라인 대비 시각 변경**을 검증하는 TC 유형입니다.

**전제조건**: `output/publish/screenshots/baseline/` 존재 + v2 이상 스크린샷 존재

| 항목 | 내용 |
|------|------|
| **ID 채번** | `TC-V-001`, `TC-V-002`, ... (V = Visual) |
| **연관** | UI-### (변경 대상 섹션) |
| **입력** | baseline 스크린샷 + 현재 버전 스크린샷 |
| **검증 방법** | 멀티모달 비교 (Read 도구로 두 이미지 분석) |
| **판정 기준** | 의도된 변경 = OK, 비의도 리그레션 = FAIL |

**TC-V 작성 구조:**
```
TC-V-###: {변경 영역} — {뷰포트}
├── 연관: UI-###
├── 뷰포트: Desktop / Tablet / Mobile
├── baseline: screenshots/baseline/render_{페이지}_{뷰포트}_v1.png
├── 현재: screenshots/render_{페이지}_{뷰포트}_v{n}.png
├── 변경 영역: {변경된 섹션/컴포넌트}
├── 유형: 의도 / 리그레션
├── 판정: OK / FAIL
└── 비고: {리그레션 시 원인 + 수정 가이드}
```

> v1(최초 퍼블리싱) 시에는 TC-V를 생성하지 않습니다. 베이스라인 확립 단계이기 때문입니다.

### 4. 실행 + 결과 기록

**정적 분석 모드:**
- HTML/CSS/JS 코드를 Read/Grep으로 직접 분석
- 링크 href 존재, 요소 구조, 이벤트 핸들러 바인딩 등 코드 수준 확인
- 각 TC 실행 후 판정(Pass/Fail/Block) 기록

**공통:**
- Fail 시 결함 등록: `DEF-###` ID 부여
- 결함 정보: 재현 단계, 스크린샷 경로(브라우저 모드 시), 심각도, 담당자

### 5. 커버리지 집계
- FN 커버리지: TC가 있는 FN 수 / 전체 FN 수
- Must 커버리지: Must 기능 중 Pass 수 / Must 전체
- 3단계 커버리지: 3단계 검증된 FN 수 / 복잡도 중간+ FN 수

## 결함 심각도

| 등급 | 기준 | 예시 |
|------|------|------|
| **Critical** | 서비스 불가, 데이터 손실 | 메인 페이지 미로딩, 결제 오류 |
| **Major** | 주요 기능 장애 | GNB 링크 깨짐, 검색 미동작 |
| **Minor** | 부분 기능 장애/UI 이슈 | 특정 뱃지 미표시, 여백 깨짐 |
| **Trivial** | 경미한 이슈 | 오탈자, 미세 정렬 차이 |

## 결과 출력

```
═══════════════════════════════════
[기능 테스트 결과]
═══════════════════════════════════
테스트 대상: {프로젝트명}
실행일: {날짜}
───────────────────────────────────
[TC 현황]
총 TC: {n}개
Pass: {n} | Fail: {n} | Block: {n} | N/A: {n}
───────────────────────────────────
[커버리지]
FN 커버리지: {n}/{n} ({%})
Must 커버리지: {n}/{n} ({%})
3단계 검증: {n}/{n} ({%})
───────────────────────────────────
[결함]
Critical: {n} | Major: {n} | Minor: {n} | Trivial: {n}
───────────────────────────────────
[판정]
{PASS / FAIL} — 근거: {사유}
═══════════════════════════════════
```

## 출력 형식
- 파일명: `TC_{프로젝트코드}_{버전}.md`
- 저장 경로: `output/qa/`

## 품질 체크
작성 완료 시 체크리스트: [checklist.md](checklist.md) 참조

$ARGUMENTS
