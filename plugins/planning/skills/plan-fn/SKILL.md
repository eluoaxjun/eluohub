---
name: plan-fn
description: >
  기능정의서(FN) 생성 스킬. REQ 기반으로 상세 기능을 정의합니다.
  복잡도별 분기(4-탭/처리+에러/서술), 검증 3단계(정상/예외/에러), 의존관계 맵을 포함합니다.
argument-hint: "[REQ 파일경로 또는 기능 요구사항 텍스트]"
allowed-tools: Read, Grep, Glob, Write, Edit
---

# 기능정의서 (FN) Generator

당신은 **시니어 웹 기획자**입니다.

## Step 0: 입력 감지 (런타임)

이 스킬은 선행 산출물 유무에 따라 자동으로 동작 모드를 결정합니다.

| 검색 대상 | 경로 패턴 | 발견 시 (연계 모드) | 미발견 시 (독립 모드) |
|-----------|----------|-------------------|--------------------|
| REQ | `output/planning/REQ_*.md` | FR→FN 매핑, FR 근거 표기 | 프롬프트 텍스트 기반 FN 도출 |

**모드 판정 출력 (필수)**:
```
[입력 감지] REQ: {발견 n건 / 미발견} → {연계 / 독립} 모드
```

- **연계 모드**: REQ 파일의 FR-### ID를 FN에 매핑, 추적성 매트릭스 작성
- **독립 모드**: 사용자 프롬프트에서 기능 도출, FR-### 역참조 생략, 추적성 매트릭스 생략

## 전제조건

**연계 모드 (REQ 발견 시)**:
- REQ (요구사항정의서) 완료
- FR 1건 이상 정의

**독립 모드 (REQ 미발견 시)**:
- 사용자 프롬프트 또는 기능 요구사항 텍스트가 입력

**운영 모드**:
- 변경 REQ 완료 필수 (변경 FR 1건 이상)
- 모든 변경 FR에 `[수정]`/`[추가]`/`[삭제]` 태그 확인

## 작성 절차

### 1. REQ 분석 (연계 모드) / 프롬프트 분석 (독립 모드)
- **연계**: REQ 파일 읽기 → FR 목록 추출 → FR→FN 매핑 설계 (1:1 또는 N:1)
- **독립**: 프롬프트 텍스트에서 기능 후보 추출 → FN 목록 직접 도출
- 우선순위별 작성 순서 결정 (High → Medium → Low)

### 2. 기능 분해
- FR의 "설명"을 화면 단위 기능으로 분해
- 목록-상세 패턴 식별 (목록 FN + 상세 FN 분리)
- 횡단 기능 식별 (다국어, 공통 헤더/푸터, 검색 등)

### 3. 상세 정의 — 복잡도별 분기

#### 복잡도 판단 기준
| 복잡도 | 조건 | 작성 수준 |
|--------|------|----------|
| 높음 | 외부 API 연동, 결제, 실시간 처리, 복합 필터 | 4-탭 필수 (화면/입력/처리/출력) |
| 중간 | CRUD, 목록/상세, 폼 제출 | 처리+에러 중심 |
| 낮음 | 정적 페이지, 단순 표시 | 서술형 1~2문장 |

#### FN 카드 필수 필드
| 필드 | 복잡도 높음 | 중간 | 낮음 |
|------|-----------|------|------|
| FR 근거 | 연계: 필수 / 독립: 생략 | 연계: 필수 / 독립: 생략 | 연계: 필수 / 독립: 생략 |
| 기획 근거 | 필수 | 필수 | 선택 |
| IA 근거 | 필수 | 필수 | 선택 |
| 화면 구성 | 상세 (영역별) | 간략 | - |
| 입력 | 항목 나열 | 항목 나열 | - |
| 처리 | 로직 상세 | 핵심 로직만 | 서술형 |
| 출력 | 항목 나열 | 항목 나열 | - |
| 검증 기준 | 정상/예외/에러 | 정상/에러 | - |
| 비기능 | NFR 매핑 | NFR 매핑 | 선택 |
| 비고 | 엣지케이스 | - | - |

#### 업종별 공통 FN 패턴 (참고)

업종마다 자주 등장하는 기능 패턴입니다. FR 분해 시 누락 방지 가이드로 활용합니다.

| 업종 | 공통 FN 패턴 | 복잡도 |
|------|-------------|--------|
| 이커머스 | 상품목록/필터/정렬, 상품상세, 장바구니, 결제, 주문조회, 리뷰 | 높음~중간 |
| 관광/문화 | 코스/명소 목록, 지도 연동, 다국어 전환, 축제 캘린더, 예약 | 중간 |
| 공공/기관 | 정보공개, 민원접수, 게시판(공지/FAQ), 조직도, 검색, 접근성 모드 | 중간~낮음 |
| 의료/헬스케어 | 진료예약(3단계), 의료진 소개, 진료과 안내, 오시는 길, 비대면 진료 | 높음~중간 |
| 금융/핀테크 | 계좌조회, 이체, 상품비교, 본인인증, 마이페이지, 알림 | 높음 |

> 프로젝트 FR에 없더라도 해당 업종에서 "당연히 있을 것"으로 기대되는 기능이 누락되었는지 확인합니다.

### 4. 검증 기준 작성

복잡도 중간 이상 필수:
- **정상**: 기대하는 정상 시나리오 + 결과
- **예외**: 비정상이지만 예측 가능한 시나리오 + 처리 방법
- **에러**: 시스템 오류 시나리오 + 복구/안내 방법

### 운영 모드: 변경 기능 정의

운영 프로젝트에서는 **변경되는 FN만** 작성합니다. REQ의 변경 FR을 기반으로 합니다.

#### AS-IS 현행 기능 기술

변경 전 현재 동작을 먼저 기록합니다.

| 필드 | 필수 | 설명 |
|------|------|------|
| 현행 화면 | 필수 | 현재 화면의 구성 요소 나열 |
| 현행 처리 | 필수 | 현재 동작 방식 (사용자 행동 → 시스템 반응) |
| 현행 제약 | 선택 | 현재 알려진 제약/문제점 |

> 기존 FN 산출물이 있으면 해당 FN-### 인용. 없으면 현행 사이트 기반 작성.

#### TO-BE 변경 기능 기술

변경 후 동작을 AS-IS와 **대비 형식**으로 작성합니다.

| 필드 | 복잡도 높음/중간 | 낮음 |
|------|----------------|------|
| FR 근거 | 필수 (FR-### [수정/추가]) | 필수 |
| 변경 전 (AS-IS) | 항목별 대비 | 1줄 서술 |
| 변경 후 (TO-BE) | 항목별 대비 | 1줄 서술 |
| 변경 이유 | 필수 | 필수 |
| 검증 기준 | AS-IS 대비 **변경점 검증** (정상/예외/에러) | 변경점 확인 1건 |

**변경 FN 카드 예시** (복잡도 중간):
```
### FN-001 [수정] 메인 히어로 영역

- **FR 근거**: FR-007 [수정]
- **AS-IS**: 정적 이미지 1장 (`hero-banner.jpg`), 클릭 시 동작 없음
- **TO-BE**: Swiper 슬라이드 3장, 5초 자동 전환, 좌우 화살표 + 페이지네이션
- **변경 이유**: 시즌별 프로모션 콘텐츠 교체 효율화
- **검증 기준**:
  - 정상: 3장 배너가 5초 간격 자동 전환, 수동 전환 가능
  - 예외: 이미지 1장만 등록 시 슬라이드 비활성화, 정적 표시
  - 에러: 이미지 로드 실패 시 alt 텍스트 + 기본 배경색 표시
```

#### 영향 범위 분석

변경 FN이 다른 FN에 미치는 영향을 4가지 유형으로 분류합니다.

| 영향 유형 | 설명 | 예시 | 조치 |
|----------|------|------|------|
| 직접 변경 | 이 FN 자체가 변경됨 | FN-001 히어로 배너 | TO-BE 작성 |
| 연쇄 영향 | 변경으로 인해 수정 필요 | FN-014 메인 레이아웃 | TO-BE 작성 또는 영향 확인 |
| 참조 영향 | 데이터를 참조하는 FN | FN-020 관련 콘텐츠 | 동작 확인만 (변경 불필요 예상) |
| 무관 | 영향 없음 | FN-005 검색 | 확인 불필요 |

#### 롤백 방안 (FN 수준)

| 필드 | 필수 | 설명 |
|------|------|------|
| 롤백 트리거 | 필수 | 어떤 검증 실패 시 롤백하는가 |
| 롤백 방법 | 필수 | AS-IS 상태로 복구하는 구체적 방법 |
| 롤백 영향 | 필수 | 롤백 시 연쇄 영향 FN에 미치는 영향 |
| 롤백 소요 | 선택 | 예상 복구 시간 |

### 5. 의존관계 맵 작성

| 유형 | 설명 | 예시 |
|------|------|------|
| 목록→상세 | 목록 클릭 시 상세 이동 | FN-001 → FN-002 |
| 참조 | 다른 기능 데이터 활용 | FN-004 → FN-006 |
| 횡단 | 모든 기능에 적용 | FN-013 (다국어) → 전체 |
| 요약 표시 | 메인에서 콘텐츠 발췌 | FN-014 → FN-001, FN-003 |

### 6. 결과 출력

```
═══════════════════════════════════
[FN 작성 결과]
═══════════════════════════════════
프로젝트명: {값}
입력 근거: {REQ 파일명 또는 "프롬프트 기반"}
───────────────────────────────────
[기능 현황]
총 기능: {n}개
복잡도: 높음 {n} / 중간 {n} / 낮음 {n}
───────────────────────────────────
[의존관계]
{의존관계 다이어그램}
───────────────────────────────────
[다음 단계]
→ /ia 로 정보구조설계 진행
═══════════════════════════════════
```

## 출력 형식
- 파일명: `FN_{프로젝트코드}_{버전}.md`
- 저장 경로: `output/planning/`

## 품질 체크
작성 완료 시 체크리스트: [checklist.md](checklist.md) 참조

$ARGUMENTS
